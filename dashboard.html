<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery 13 | –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/config.js" defer></script>
    <script src="js/auth.js" defer></script>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ Gallery 13 -->
        <header class="gallery-header">
            <div class="header-left">
                <button class="btn-icon back-btn" onclick="window.location.href='index.html'">
                    üè†
                </button>
                <div class="gallery-brand">
                    <span class="brand-icon">üñºÔ∏è</span>
                    <div>
                        <h1>Gallery 13</h1>
                        <p class="brand-subtitle">Control Panel</p>
                    </div>
                </div>
            </div>
            
            <div class="user-profile">
                <div class="user-avatar">
                    <span id="user-avatar">üë§</span>
                </div>
                <button class="btn-icon" id="notifications-btn" title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è">
                    üîî<span class="notification-badge" id="notification-count">0</span>
                </button>
                <button class="btn-icon" id="logout-btn" title="–í—ã–π—Ç–∏">
                    üö™
                </button>
            </div>
        </header>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–º–æ–¥–∞–ª—å–Ω–æ–µ) -->
        <div class="modal-overlay" id="notifications-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
                    <button class="btn-icon" onclick="hideNotifications()">‚úï</button>
                </div>
                <div class="notifications-list" id="notifications-list">
                    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ -->
        <div class="employee-card">
            <div class="employee-info">
                <h3 id="employee-name"></h3>
                <div class="employee-details">
                    <span class="badge role-badge" id="employee-role"></span>
                    <span class="location-tag" id="employee-location"></span>
                </div>
                <p class="employee-position" id="employee-position"></p>
            </div>
            <div class="current-time">
                <span id="current-time"></span>
                <small id="current-date"></small>
            </div>
        </div>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∞–º–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) -->
        <div class="card" id="locations-management" style="display: none;">
            <div class="section-header">
                <h3>üìç –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∞–º–∏</h3>
                <button class="btn-icon" onclick="showAddLocationForm()">‚ûï</button>
            </div>
            <div class="locations-list" id="locations-list">
                <!-- –¢–æ—á–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª -->
        <div class="section-title">
            <h2>‚ö° –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h2>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Gallery 13</p>
        </div>

        <div class="dashboard-grid">
            <!-- –û—Ç—á–µ—Ç -->
            <div class="feature-card gradient-purple" id="report-card">
                <div class="feature-icon">üìä</div>
                <h3>–°—É—Ç–æ—á–Ω—ã–π –æ—Ç—á–µ—Ç</h3>
                <p>–ö–∞—Å—Å–∞, –≤–∏—Ç—Ä–∏–Ω—ã, —Å–æ—Å—Ç–æ—è–Ω–∏–µ</p>
            </div>

            <!-- –ê–Ω–æ–Ω–∏–º–Ω—ã–µ –∂–∞–ª–æ–±—ã -->
            <div class="feature-card gradient-blue" id="complaints-card">
                <div class="feature-icon">üïµÔ∏è</div>
                <h3>–ê–Ω–æ–Ω–∏–º–Ω—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è</h3>
                <p>–¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏</p>
                <div class="notification-badge" id="complaints-count">0</div>
            </div>

            <!-- –ö–∞–Ω—Ü–µ–ª—è—Ä–∏—è -->
            <div class="feature-card gradient-green" id="stationery-card">
                <div class="feature-icon">üñäÔ∏è</div>
                <h3>–ö–∞–Ω—Ü–µ–ª—è—Ä–∏—è</h3>
                <p>–ó–∞–∫–∞–∑ –¥–ª—è –≤—Å–µ—Ö —Ç–æ—á–µ–∫</p>
            </div>

            <!-- –û–±—â–∏–π —á–∞—Ç -->
            <div class="feature-card gradient-orange" id="chat-card">
                <div class="feature-icon">üí¨</div>
                <h3>–ö–æ–º–∞–Ω–¥–Ω—ã–π —á–∞—Ç</h3>
                <p>–û–±—â–µ–Ω–∏–µ —Å —Ñ–æ—Ç–æ</p>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ -->
            <div class="feature-card gradient-red" id="employees-card">
                <div class="feature-icon">üë•</div>
                <h3>–ö–æ–º–∞–Ω–¥–∞</h3>
                <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º</p>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="feature-card gradient-teal" id="stats-card">
                <div class="feature-icon">üìà</div>
                <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <p>–û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</p>
            </div>
        </div>

        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="section-title">
            <h2>üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
            <p>–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</p>
        </div>

        <div class="quick-actions-grid">
            <button class="quick-action-btn" onclick="sendQuickReport('open')">
                <span class="action-icon">üîì</span>
                –û—Ç–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã
            </button>
            
            <button class="quick-action-btn" onclick="sendQuickReport('close')">
                <span class="action-icon">üîí</span>
                –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã
            </button>
            
            <button class="quick-action-btn" onclick="window.location.href='stationery.html?item=water'">
                <span class="action-icon">üíß</span>
                –ó–∞–∫–∞–∑–∞—Ç—å –≤–æ–¥—É
            </button>
            
            <button class="quick-action-btn" onclick="window.location.href='report.html?template=daily'">
                <span class="action-icon">üìã</span>
                –î–Ω–µ–≤–Ω–æ–π –æ—Ç—á–µ—Ç
            </button>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ—á–∫–∏ (–º–æ–¥–∞–ª—å–Ω–æ–µ) -->
    <div class="modal-overlay" id="add-location-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìç –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ç–æ—á–∫—É</h2>
                <button class="btn-icon" onclick="hideAddLocationForm()">‚úï</button>
            </div>
            <form id="add-location-form">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏ *</label>
                    <input type="text" id="location-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Gallery 13 - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π" required>
                </div>
                
                <div class="form-group">
                    <label>–ê–¥—Ä–µ—Å *</label>
                    <input type="text" id="location-address" placeholder="–ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å" required>
                </div>
                
                <div class="form-group">
                    <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="tel" id="location-phone" placeholder="+7 (XXX) XXX-XX-XX">
                </div>
                
                <div class="form-group">
                    <label>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</label>
                    <input type="text" id="location-manager" placeholder="–§–ò–û –º–µ–Ω–µ–¥–∂–µ—Ä–∞">
                </div>
                
                <div class="form-group">
                    <label>–¢–∏–ø —Ç–æ—á–∫–∏</label>
                    <select id="location-type">
                        <option value="main">–û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ª</option>
                        <option value="office">–û—Ñ–∏—Å</option>
                        <option value="showroom">–®–æ—É—Ä—É–º</option>
                        <option value="storage">–°–∫–ª–∞–¥</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="hideAddLocationForm()">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            if (!window.currentEmployee) {
                window.location.href = 'index.html';
                return;
            }

            const employee = window.currentEmployee;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ
            document.getElementById('employee-name').textContent = employee.name;
            document.getElementById('employee-role').textContent = 
                GALLERY13_CONFIG.roles[employee.role];
            document.getElementById('employee-position').textContent = 
                employee.position || employee.role;
            
            // –ù–∞—Ö–æ–¥–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏
            const location = GALLERY13_CONFIG.locations.find(l => l.id === employee.location);
            document.getElementById('employee-location').textContent = 
                location ? location.name : employee.location;

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤–∞—Ç–∞—Ä –ø–æ —Ä–æ–ª–∏
            const avatars = {
                admin: 'üë®‚Äçüíº',
                assistant: 'üë©‚Äçüíº',
                manager: 'üëî',
                cashier: 'üí∞',
                consultant: 'üíÅ'
            };
            document.getElementById('user-avatar').textContent = avatars[employee.role] || 'üë§';

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
            function updateTime() {
                const now = new Date();
                document.getElementById('current-time').textContent = 
                    now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
                document.getElementById('current-date').textContent = 
                    now.toLocaleDateString('ru-RU', { weekday: 'long', day: 'numeric', month: 'long' });
            }
            updateTime();
            setInterval(updateTime, 60000);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
            const permissions = GALLERY13_CONFIG.permissions[employee.role];
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∞–º–∏ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º
            if (permissions.includes('manage_locations')) {
                document.getElementById('locations-management').style.display = 'block';
                loadLocationsList();
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            if (!permissions.includes('report')) {
                document.getElementById('report-card').style.display = 'none';
            }
            if (!permissions.includes('complaints')) {
                document.getElementById('complaints-card').style.display = 'none';
            }
            if (!permissions.includes('manage_employees')) {
                document.getElementById('employees-card').style.display = 'none';
            }

            // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
            document.getElementById('report-card').addEventListener('click', () => {
                window.location.href = 'report.html';
            });
            
            document.getElementById('complaints-card').addEventListener('click', () => {
                window.location.href = 'anonymous.html';
            });
            
            document.getElementById('stationery-card').addEventListener('click', () => {
                window.location.href = 'stationery.html';
            });
            
            document.getElementById('chat-card').addEventListener('click', () => {
                window.location.href = 'chat.html';
            });
            
            document.getElementById('employees-card').addEventListener('click', () => {
                window.location.href = 'employees.html';
            });
            
            document.getElementById('stats-card').addEventListener('click', () => {
                showStatistics();
            });

            // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            document.getElementById('notifications-btn').addEventListener('click', showNotifications);
            updateNotificationCount();

            // –í—ã—Ö–æ–¥
            document.getElementById('logout-btn').addEventListener('click', function() {
                if (confirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã?')) {
                    window.currentEmployee = null;
                    localStorage.removeItem('gallery13_employee');
                    window.location.href = 'index.html';
                }
            });

            // –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ—á–∫–∏
            document.getElementById('add-location-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewLocation();
            });
        });

        function loadLocationsList() {
            const container = document.getElementById('locations-list');
            const locations = GALLERY13_CONFIG.locations;
            
            if (locations.length === 0) {
                container.innerHTML = '<p class="hint">–¢–æ—á–∫–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>';
                return;
            }
            
            container.innerHTML = '';
            locations.forEach(location => {
                const locationEl = document.createElement('div');
                locationEl.className = 'location-item';
                locationEl.innerHTML = `
                    <div class="location-item-info">
                        <strong>${location.name}</strong>
                        <small>${location.address}</small>
                    </div>
                    <div class="location-item-actions">
                        <button class="btn-icon" onclick="editLocation('${location.id}')" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                            ‚úèÔ∏è
                        </button>
                        <button class="btn-icon" onclick="deleteLocation('${location.id}')" title="–£–¥–∞–ª–∏—Ç—å">
                            üóëÔ∏è
                        </button>
                    </div>
                `;
                container.appendChild(locationEl);
            });
        }

        function showAddLocationForm() {
            document.getElementById('add-location-modal').style.display = 'flex';
        }

        function hideAddLocationForm() {
            document.getElementById('add-location-modal').style.display = 'none';
            document.getElementById('add-location-form').reset();
        }

        function addNewLocation() {
            const locationData = {
                name: document.getElementById('location-name').value,
                address: document.getElementById('location-address').value,
                phone: document.getElementById('location-phone').value || '',
                manager: document.getElementById('location-manager').value || '',
                type: document.getElementById('location-type').value
            };

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É —á–µ—Ä–µ–∑ ConfigManager
            const newLocation = ConfigManager.addLocation(locationData);
            
            if (newLocation) {
                showNotification('‚úÖ –ù–æ–≤–∞—è —Ç–æ—á–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
                hideAddLocationForm();
                loadLocationsList();
            }
        }

        function editLocation(locationId) {
            const location = GALLERY13_CONFIG.locations.find(l => l.id === locationId);
            if (!location) return;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('location-name').value = location.name;
            document.getElementById('location-address').value = location.address;
            document.getElementById('location-phone').value = location.phone || '';
            document.getElementById('location-manager').value = location.manager || '';
            document.getElementById('location-type').value = location.type || 'main';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('add-location-modal').style.display = 'flex';
            
            // TODO: –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        }

        function deleteLocation(locationId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç–æ—á–∫—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                if (ConfigManager.deleteLocation(locationId)) {
                    showNotification('üóëÔ∏è –¢–æ—á–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
                    loadLocationsList();
                }
            }
        }

        function showNotifications() {
            const notifications = ConfigManager.getNotifications();
            const container = document.getElementById('notifications-list');
            
            if (notifications.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üîî</div>
                        <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ—Ç</h3>
                        <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤–∞–∂–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</p>
                    </div>
                `;
            } else {
                let html = '';
                notifications.forEach(notif => {
                    const type = GALLERY13_CONFIG.notificationTypes[notif.type] || notif.type;
                    const time = new Date(notif.timestamp).toLocaleTimeString('ru-RU', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    html += `
                        <div class="notification-item">
                            <div class="notification-header">
                                <span class="notification-type">${type}</span>
                                <span class="notification-time">${time}</span>
                            </div>
                            <div class="notification-content">
                                ${JSON.stringify(notif.data, null, 2)}
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
            }
            
            document.getElementById('notifications-modal').style.display = 'flex';
        }

        function hideNotifications() {
            document.getElementById('notifications-modal').style.display = 'none';
        }

        function updateNotificationCount() {
            const notifications = ConfigManager.getNotifications();
            const newNotifications = notifications.filter(n => 
                new Date(n.timestamp) > new Date(Date.now() - 24 * 60 * 60 * 1000) // –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
            );
            document.getElementById('notification-count').textContent = newNotifications.length || '';
        }

        function sendQuickReport(type) {
            const reports = {
                'open': '–û—Ç—á–µ—Ç –æ–± –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–º–µ–Ω—ã',
                'close': '–û—Ç—á–µ—Ç –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–º–µ–Ω—ã'
            };
            
            if (confirm(`–û—Ç–ø—Ä–∞–≤–∏—Ç—å ${reports[type]}?`)) {
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç—á–µ—Ç–∞
                const reportData = {
                    type: type,
                    employee: window.currentEmployee,
                    timestamp: new Date().toISOString(),
                    location: window.currentEmployee.location
                };
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É
                ConfigManager.sendAdminNotification('new_report', {
                    type: reports[type],
                    employee: window.currentEmployee.name,
                    location: GALLERY13_CONFIG.locations.find(l => l.id === window.currentEmployee.location)?.name
                });
                
                showNotification(`‚úÖ ${reports[type]} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω`);
            }
        }

        function showStatistics() {
            // –ü—Ä–æ—Å—Ç–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const stats = {
                totalLocations: GALLERY13_CONFIG.locations.length,
                totalEmployees: EMPLOYEES_DB.length,
                activeEmployees: EMPLOYEES_DB.filter(e => e.status === 'active').length,
                today: new Date().toLocaleDateString('ru-RU')
            };
            
            alert(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Gallery 13\n\n–¢–æ—á–∫–∏: ${stats.totalLocations}\n–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏: ${stats.totalEmployees} (–∞–∫—Ç–∏–≤–Ω—ã—Ö: ${stats.activeEmployees})\n–î–∞—Ç–∞: ${stats.today}`);
        }
    </script>
</body>
</html>